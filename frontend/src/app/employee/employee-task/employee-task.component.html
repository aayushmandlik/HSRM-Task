<div class="container mx-auto p-4">
  <h2 class="text-2xl font-bold mb-4">My Tasks</h2>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="text-red-500 mb-4">{{ errorMessage }}</div>

  <!-- Tasks Table -->
  <table class="min-w-full bg-white border border-gray-300">
    <thead>
      <tr class="bg-gray-200">
        <th class="py-2 px-4 border-b">Title</th>
        <th class="py-2 px-4 border-b">Description</th>
        <th class="py-2 px-4 border-b">Assigned To</th>
        <th class="py-2 px-4 border-b">Assigned By</th>
        <th class="py-2 px-4 border-b">Status</th>
        <th class="py-2 px-4 border-b">Priority</th>
        <th class="py-2 px-4 border-b">Due Date</th>
        <th class="py-2 px-4 border-b">Project</th>
        <th class="py-2 px-4 border-b">Comments</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let task of tasks" class="hover:bg-gray-100">
        <td class="py-2 px-4 border-b">{{ task.title }}</td>
        <td class="py-2 px-4 border-b">{{ task.description }}</td>
        <td class="py-2 px-4 border-b">{{ task.assigned_to.join(', ') }}</td>
        <td class="py-2 px-4 border-b">{{ task.assigned_by }}</td>
        <td class="py-2 px-4 border-b">
          <select (change)="updateTaskStatus(task.id, $event)" class="border p-1">
            <option *ngIf="!task.status" value="">Select Status</option>
            <option *ngFor="let status of ['Pending', 'In Progress', 'Completed']" [value]="status" [selected]="task.status === status">
              {{ status }}
            </option>
          </select>
        </td>
        <td class="py-2 px-4 border-b">{{ task.priority }}</td>
        <td class="py-2 px-4 border-b">{{ task.due_date | date:'medium' }}</td>
        <td class="py-2 px-4 border-b">{{ task.project || 'N/A' }}</td>
        <td class="py-2 px-4 border-b">
          <img src="src/assets/comment-icon.png" (click)="openCommentModal(task.id)" alt="Add Comment" class="w-6 h-6 cursor-pointer">
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Comment Modal -->
  <div *ngIf="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded-lg w-1/3">
      <h3 class="text-lg font-bold mb-4">Add Comment</h3>
      <form (ngSubmit)="onSubmitComment()" [formGroup]="commentForm">
        <div class="mb-4">
          <label for="user_id" class="block text-sm font-medium text-gray-700">User ID</label>
          <input id="user_id" formControlName="user_id" type="text" class="mt-1 block w-full border rounded p-2">
        </div>
        <div class="mb-4">
          <label for="message" class="block text-sm font-medium text-gray-700">Message</label>
          <textarea id="message" formControlName="message" class="mt-1 block w-full border rounded p-2" rows="3"></textarea>
        </div>
        <div class="flex justify-end">
          <button type="button" (click)="closeCommentModal()" class="mr-2 px-4 py-2 bg-gray-300 rounded">Cancel</button>
          <button type="submit" [disabled]="!commentForm.valid" class="px-4 py-2 bg-blue-500 text-white rounded">Submit</button>
        </div>
      </form>
      <div *ngIf="errorMessage" class="text-red-500 mt-2">{{ errorMessage }}</div>
    </div>
  </div>
</div>